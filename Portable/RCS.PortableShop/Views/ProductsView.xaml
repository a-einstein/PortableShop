<?xml version="1.0" encoding="UTF-8"?>

<BaseClasses:View
    x:Class="RCS.PortableShop.Views.ProductsView"  
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:BaseClasses="clr-namespace:RCS.PortableShop.Common.Views;assembly=RCS.PortableShop.Common"
    xmlns:Converters="clr-namespace:RCS.PortableShop.Common.Converters;assembly=RCS.PortableShop.Common"
    xmlns:Localization="clr-namespace:RCS.PortableShop.Localization;assembly=RCS.PortableShop"
    xmlns:Styles="clr-namespace:RCS.PortableShop.Common.Styles;assembly=RCS.PortableShop.Common"
    >
    <!--xmlns:Main="clr-namespace:RCS.PortableShop.Main;assembly=RCS.PortableShop"-->

    <BaseClasses:View.Resources>
        <!--TODO Merge does not work either way, here or in MainApplication.-->
        <ResourceDictionary MergedWith="Styles:GeneralStyle">
            <!--<Converters:CategoriesFormatter x:Key="CategoriesFormatter"/>-->
            <!--<Converters:SizeFormatter x:Key="SizeFormatter"/>-->
            <Converters:ByteArrayToBitmapImageConverter x:Key="ByteArrayToBitmapImageConverter"/>
            <Converters:HasValueTester x:Key="HasValueTester"/>
            <!--<Converters:HasValueMultiTester x:Key="HasValueMultiTester"/>-->
        </ResourceDictionary>
    </BaseClasses:View.Resources>

    <!--Background="{StaticResource ProductBackgroundBrush}"-->
    <!--TODO Does this HAVE to be DynamicResource?!-->
    <!--TODO Does not work either way, DynamicResource (values) or StaticResource (error), -->
    <Frame Style="{DynamicResource FrameStyle}">
        <Grid >
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackLayout Margin="0,0,0,2">
                <Label Text="{Localization:Translate Products}" Style="{DynamicResource MainHeaderLabelStyle}"/>

                <StackLayout Orientation="Horizontal">
                    <!--Style="{StaticResource LineLabelStyle}"-->
                    <Label Text="{Localization:Translate MasterFilter}"/>
                    <!--TODO Check https://forums.xamarin.com/discussion/17875/binding-to-picker-items-->
                    <!--Style="{StaticResource FilterComboBoxStyle}"-->
                    <!--<Picker Items="{Binding MasterFilterItems}" SelectedValue="{Binding MasterFilterValue}" IsEnabled="{Binding MasterFilterItems, Converter={StaticResource HasValueTester}}"/>-->

                    <!--Style="{StaticResource LineLabelStyle}"-->
                    <Label Text="{Localization:Translate DetailFilter}"/>
                    <!--Style="{StaticResource FilterComboBoxStyle}"-->
                    <!--<Picker Items="{Binding DetailFilterItems}" SelectedValue="{Binding DetailFilterValue}" IsEnabled="{Binding DetailFilterItems, Converter={StaticResource HasValueTester}}"/>-->

                    <!--Style="{StaticResource LineLabelStyle}"-->
                    <Label Text="{Localization:Translate TextFilter}"/>
                    <!--Note this field has to be tabbed out to reach the default button by the enter key.-->
                    <!--Style="{StaticResource LineTextBoxStyle}" Width="200"-->
                    <Entry Text="{Binding TextFilterValue, Mode=TwoWay}" />

                    <!--IsDefault="True" Margin="{StaticResource StandardHorizontalSeparation}"-->
                    <Button Text="{Localization:Translate Filter}" Command="{Binding FilterCommand}">
                        <!--Note this prevents unfiltered queries.-->
                        <Button.IsEnabled>
                            <!--<MultiBinding Converter="{StaticResource HasValueMultiTester}">
                                <Binding Path="MasterFilterValue"/>
                                <Binding Path="DetailFilterValue"/>
                                <Binding Path="TextFilterValue"/>
                            </MultiBinding>-->
                        </Button.IsEnabled>
                    </Button>

                    <!--Style="{StaticResource LineValueLabelStyle}"-->
                    <Label Text="{Binding ItemsCount}"/>
                    <!--Style="{StaticResource LineLabelStyle}"-->
                    <Label Text="{Localization:Translate Products}"/>
                </StackLayout>
            </StackLayout>

            <!--Style="{StaticResource FrameStyle}"-->
            <Frame Grid.Row="1">
                <!--Note this does not work within a StackLayout-->
                <ScrollView Orientation="Vertical">
                    <!--Name="productsItemsControl" Background="#FFEAF7FF" Padding="2"-->
                    <ListView ItemsSource="{Binding Items}">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <!--Style="{StaticResource FrameStyle}" Background="{StaticResource ProductBackgroundBrush}"-->
                                <Frame >
                                    <!--Width="300"-->
                                    <Grid >
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="5"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!--Style="{StaticResource ImageStyle}"-->
                                        <Image Grid.Column="0" Source="{Binding ThumbNailPhoto, Converter={StaticResource ByteArrayToBitmapImageConverter}}" MaxWidth="80" MaxHeight="80" />

                                        <StackLayout Grid.Column="0" Orientation="Vertical" VerticalAlignment="Bottom" HorizontalAlignment="Left">
                                            <!--Command="{Binding BindingContext.DetailsCommand, Source={x:Reference productsItemsControl}" CommandParameter="{Binding}" Style="{StaticResource DetailsButtonStyle}" Background="{StaticResource ProductBackgroundBrush}"-->
                                            <Button Text="{Localization:Translate Details}" />
                                            <!-- Command="{Binding BindingContext.CartCommand, Source={x:Reference productsItemsControl}}" CommandParameter="{Binding}" Style="{StaticResource DetailsButtonStyle}" Background="{StaticResource CartBackgroundBrush}"-->
                                            <Button Text="{Localization:Translate IncreaseProduct}" />
                                        </StackLayout>

                                        <StackLayout Grid.Column="2">
                                            <!--Style="{StaticResource LabelStyle}"-->
                                            <Label>
                                                <Label.Text>
                                                    <!--<MultiBinding Converter="{StaticResource CategoriesFormatter}">
                                                        <Binding Path="ProductCategory"/>
                                                        <Binding Path="ProductSubcategory"/>
                                                    </MultiBinding>-->
                                                </Label.Text>
                                            </Label>

                                            <!--Style="{StaticResource LabelStyle}"-->
                                            <Label Text="{Binding Name}" FontWeight="Bold" FontSize="16"/>

                                            <!--Style="{StaticResource LabelStyle}"-->
                                            <Label Text="{Binding ListPrice, StringFormat=\{0:C2\}}" FontWeight="Bold" FontSize="12"/>

                                            <!--Style="{StaticResource LabelStyle}"-->
                                            <Label >
                                                <Label.Text>
                                                    <MultiBinding Converter="{StaticResource SizeFormatter}">
                                                        <Binding Path="Size"/>
                                                        <Binding Path="SizeUnitMeasureCode"/>
                                                    </MultiBinding>
                                                </Label.Text>
                                            </Label>

                                            <!--Style="{StaticResource LabelStyle}"-->
                                            <Label Text="{Binding Color}" />
                                        </StackLayout>
                                    </Grid>

                                </Frame>
                            </DataTemplate>
                        </ListView.ItemTemplate>

                        <!--<ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>-->
                    </ListView>
                </ScrollView>
            </Frame>
        </Grid>
    </Frame>
</BaseClasses:View>
